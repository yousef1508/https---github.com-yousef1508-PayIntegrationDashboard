@model PayrollIntegrationDashboard.Models.EmployeeMetricsViewModel
@using System.Globalization

@{
    ViewData["Title"] = $"Employee {Model.EmployeeId} – Metrics";
    var culture = CultureInfo.GetCultureInfo("nb-NO");
}

<div class="mb-3">
    <a asp-action="Index" class="btn btn-link p-0">&larr; Back to dashboard</a>
</div>

<div class="row g-4">
    <div class="col-lg-4">
        <div class="card p-3">
            <h5 class="mb-1">Employee @Model.EmployeeId</h5>
            <small class="text-muted">Period @Model.Period</small>

            <dl class="mt-3 mb-0 small">
                <dt>Total hours</dt>
                <dd>@Model.TotalHours</dd>

                <dt>Hourly rate</dt>
                <dd>@Model.HourlyRate.ToString("C0", culture)</dd>

                <dt>Gross pay</dt>
                <dd>@Model.GrossPay.ToString("C0", culture)</dd>

                <dt>Tax (@Model.TaxRatePercent %)</dt>
                <dd>@Model.TaxAmount.ToString("C0", culture)</dd>

                <dt>Company cut (@Model.CommissionRatePercent %)</dt>
                <dd>@Model.CommissionAmount.ToString("C0", culture)</dd>

                <dt>Take-home (net)</dt>
                <dd class="fw-semibold">@Model.NetPay.ToString("C0", culture)</dd>
            </dl>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card p-3">
            <h6 class="mb-1">Payout distribution</h6>
            <small class="text-muted">How the gross payout is split between employee, tax and company</small>

            <div class="chart-wrapper mt-3">
                <canvas id="pieChart"></canvas>
            </div>

            <div class="mt-3 small text-muted">
                <p class="mb-1">
                    <strong>Take-home (net):</strong>
                    @Model.NetPay.ToString("C0", culture) – what the employee actually receives.
                </p>
                <p class="mb-1">
                    <strong>Tax:</strong>
                    @Model.TaxAmount.ToString("C0", culture) (@Model.TaxRatePercent %) – estimated income tax.
                </p>
                <p class="mb-0">
                    <strong>Company cut:</strong>
                    @Model.CommissionAmount.ToString("C0", culture) (@Model.CommissionRatePercent %) – margin/fee retained by the company.
                </p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctxPie = document.getElementById('pieChart').getContext('2d');

        const net = @Model.NetPay;
        const tax = @Model.TaxAmount;
        const commission = @Model.CommissionAmount;

        new Chart(ctxPie, {
            type: 'pie',
            data: {
                labels: ['Take home (net)', 'Tax', 'Company cut'],
                datasets: [{
                    data: [net, tax, commission]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    </script>
}
